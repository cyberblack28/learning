<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>4.Webサーバの構築</title>

    <!-- Bootstrap -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/custom.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <header class="header_area">
      <h1>東京電子専門学校 Linux 演習課題</h1>
    </header>

    <hr>

    <div class="contents_area">
      <h2>4.Webサーバの構築</h2>

      <h3>Webサーバの構築テキスト</h3>

      <h4 class="h4_title">1.Apacheのインストール</h4>

      <h4>CentOS7_WORDPRESSの仮想マシンで実行すること</h4>

      <ol>
        <li>httpdのインストール<br>yum install -y httpd</li>
        <li>httpdのバージョン確認<br>httpd -v</li>
        <li>httpdの自動起動設定<br>systemctl enable httpd<br>systemctl list-unit-files --type=service | grep httpd</li>
        <li>httpdの起動<br>systemctl start httpd<br>systemctl status httpd</li>
        <li>外部からアクセスできるようにfirewalldでhttpを解放<br>firewall-cmd --add-service=http --zone=public --permanent</li>
        <li>設定を反映<br>firewall-cmd --reload</li>
      </ol>

      <h4 class="h4_title">２.Apacheのセキュリティ設定～Welcomeページの非表示～</h4>

      <ol>
              <li>welcome.confの設定変更<br>vim /etc/httpd/conf.d/welcome.conf<pre>
・
・
&lt;LocationMatch "^/+$"&gt;
    Options -Indexes
    errorDocument 403 /.noindex.html
&lt;/LocationMatch&gt;
                  
⇓変更

#&lt;LocationMatch "^/+$"&gt;
#    Options -Indexes
#    errorDocument 403 /.noindex.html
#&lt;/LocationMatch&gt;
・
・
</pre>Esc + :wq</li>
              <li>httpdをリロード<br>systemctl reload httpd</li>
      </ol>

      <h4 class="h4_title">３.Apacheのセキュリティ設定～ディレクトリリスティングの無効～</h4>
      
      <ol>
        <li>DocumentRootディレクトリに移動<br>cd /var/www/html</li>
        <li>任意のディレクトリとファイルを作成<br>mkdir test<br>touch test.html</li>
      </ol>

      <hr>

      <ol>
        <li>httpd.confファイルのバックアップ<br>cp -p /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.org</li>
        <li>vim /etc/httpd/conf/httpd.conf
<pre>
・
・
&lt;Directory "/var/www/html"&gt;
・
・
Options Indexes FollowSymLinks　変更⇒　 Options FollowSymLinks
</pre>Esc + :wq</li>
        <li>httpdをリロード<br>systemctl reload httpd</li>
      </ol>

      <h4 class="h4_title">４.Apacheのセキュリティ設定～Traceメソッドの無効化とレスポンスヘッダのバージョン表示無効化～</h4>
      
      <ol>
        <li>DocumentRootディレクトリに移動<br>cd /var/www/html</li>
        <li>任意のhtmlファイルの作成<br>vim index.html<pre>
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;title&gt;test page&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1>Hello World !!&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>Esc + :wq
        </li>
        <li>Google Chromeのデバッグツールで確認<br>Chrome起動後右クリック[検証]、192.168.56.28にアクセス、[Network]-[192.168.56.28]アイコンをクリック、Response Headersを確認。</li>
      </ol>

      <hr>

      <ol>
        <li>ディレクトリ移動<br>cd /etc/httpd/conf.d</li>
        <li>vim security.conf
<pre>
# Trace Method off
TraceEnable Off
    
# Hide Response Header Version information
ServerTokens Prod    
</pre>Esc + :wq</li>
        <li>httpdをリロード<br>systemctl reload httpd</li>
      </ol>

      <h4 class="h4_title">５.HTTPS通信</h4>

      <ol>
        <li>Openssl、mod_sslをインストール<br>yum install -y openssl mod_ssl</li>
        <li>秘密鍵を作成<br>cd /etc/httpd/conf<br>openssl genrsa -aes128 1024 > server.key<pre>
Generating RSA private key, 1024 bit long modulus
......................++++++
..++++++
e is 65537 (0x10001)
Enter pass phrase:     ←任意のパスフレーズ
Verifying - Enter pass phrase:</pre>
        <li>公開鍵を作成<br>openssl req -new -key server.key > server.csr<pre>
Enter pass phrase for server.key:     ←2で入力したパスフレーズ
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:JP
State or Province Name (full name) []:Tokyo
Locality Name (eg, city) [Default City]:Toshimaku
Organization Name (eg, company) [Default Company Ltd]:[Enterキー]
Organizational Unit Name (eg, section) []:[Enterキー]
Common Name (eg, your name or your server's hostname) []:192.168.56.28
Email Address []:[Enterキー]
            
Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:[Enterキー]
An optional company name []:[Enterキー]
</pre></li>
        <li>秘密鍵と公開鍵で証明書を作成<br>openssl x509 -in server.csr -days 36500 -req -signkey server.key > server.crt<pre>
Signature ok
subject=/C=JP/ST=Tokyo/L=Toshimaku/O=Default Company Ltd/CN=192.168.56.28
Getting Private key
Enter pass phrase for server.key:   ←2で入力したパスフレーズ
unable to load Private key
140606308706208:error:06065064:digital envelope routines:EVP_DecryptFinal_ex:bad decrypt:evp_enc.c:604:
140606308706208:error:0906A065:PEM routines:PEM_do_header:bad decrypt:pem_lib.c:483:
</pre></li>
        <li>パスフレーズの解除<br>mv server.key server.key.bak<br>openssl rsa -in server.key.bak > server.key<pre>
Enter pass phrase for server.key.back:   ←2で入力したパスフレーズ
writing RSA key
</pre>           
        </li>
        <li>ssl.confに設定<br>vim /etc/httpd/conf.d/ssl.conf<pre>
・
・
SSLCertificateFile /etc/pki/tls/certs/localhost.crt
↓変更
SSLCertificateFile /etc/httpd/conf/server.crt
            
SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
↓変更
SSLCertificateKeyFile /etc/httpd/conf/server.key
・
・           
</pre>
        </li>
        <li>httpdの再起動<br>systemctl restart httpd</li>
        <li>外部からアクセスできるようにfirewalldでhttpsを解放<br>firewall-cmd --add-service=https --zone=public --permanent</li>
        <li>設定を反映<br>firewall-cmd --reload</li>
      </ol>

      <p class="text_align_center"><a href="../kouki.html">後期トップへ戻る</a></p>
      
      <p class="text_align_center"><a href="../index.html">トップへ戻る</a></p>

    </div>

    <hr>

    <footer class="footer_area">
      <p class="text_align_center">&copy; cyberblack28</p>
    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="../js/bootstrap.min.js"></script>
  </body>
</html>
